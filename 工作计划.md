## 工作计划
### 1.	隐私保护守则及保密工作
本项目建立在严格保护开发者隐私的基础上。

隐私防护有三个级别：

一级防护：使用未关联国内身份的墙外账号

二级防护：使用虚拟邮箱号及虚拟电话号申请的墙外账号

三级防护：使用虚拟机、多重代理、肉身翻墙等最高级防护手段

在工作交流中，应至少使用一级防护，建议使用二重防护；开发完成后，进行宣传推广时，应使用二级防护，或使用该项目本身的功能（去中心化通信），建议使用三级防护。

保密工作的任务：

1. 研究防护手段，包括虚拟邮箱电话、虚拟机、多重代理等技术的使用细则，最好开发出集成的工具；研究其他防护手段。

2. 研究宣传推广的安全词。例如，由于去中心化通信有很多用处，包括可以传输大文件等，进行宣传推广时应尽量从这些角度出发。


### 2.	Web3相关工作
1. 短账号申请机制

在p2p中，每个用户的账号是以太坊的公钥（地址），添加好友要使用这个名称比较麻烦，因此需要短账号（类似微信号、短域名）机制。本任务包括：设计以太坊智能合约，将以太坊账号和短账号关联起来，并设计拍卖系统和年管理费系统。用以太坊的web3 api编写相应的js代码。用相关框架进行测试。


2. 去中心化匿名树洞

树洞的去中心化和匿名化会面临如下问题：如果没有服务器，怎么验证发帖的是不是通过验证的注册用户？（用数字签名）；发帖人怎样在证明自己是注册用户的同时，避免泄露用户名？（用环签名）；旁人不知道发帖人的用户名，如何确保同一发帖人在同一树洞下有同一昵称？（用改进后的可关联环签名）；旁人不知道发帖人的用户名，如何确保被禁言用户无法再发帖？（用改进后的可关联环签名+无关用户自证）。为理解技术基础，需要阅读

https://www.getmonero.org/library/Zero-to-Monero-2-0-0.pdf

并了解其cpp代码，想办法移植到web上。

### 3.	网络架构工作
1. 局域网穿透

探索webRTC、webTorrent、BitTorrent等框架，找到最稳定的连接方式。作为参考，目前我们用的是

https://github.com/dmotz/trystero

通过BitTorrent找到peer信息，然后通过webRTC的信令服务器。我们还用了

https://github.com/ferrolho/magnet-player

通过webTorrent来传输大文件。但是，webRTC的服务器不稳定，需要继续研究和改进。

2. 网络拓扑结构

浏览器的p2p连接上限是500条，因此不能和所有群成员连接。要设计一种连接方式，最大化连通性和鲁棒性，最小化连接数。

3. 洋葱路由

P2p连接会暴露ip地址，因此需要设计和Tor类似的流量转发机制。


### 4.	前端工作
1. 文件管理、预览

我们已经做好了大文件传输的功能，可以试着发送视频、pdf等文件。但是，视频的边下边播以及pdf的预览还有问题，希望能改进成类似微信或浏览器的文件查看界面。作为参考，我们现在使用的是https://github.com/ferrolho/magnet-player ，
见src/components/GenalMessage.vue 19行。

2. 公众号和朋友圈

类似微信。

3. 私聊（Yuchen）

为了防止接收方离线时收不到消息，发送方将加密的消息发给接收方的所有好友。
4. 聊天记录导入和导出（Yunchen）

### 5.	数据结构及数据库工作
1. 重新设计私聊和群聊统一的消息数据结构（Yunchen）

前端传入的消息结构在src/types/chat.d.ts，一条消息包含：发送者id，目标id，内容，消息类型（图文等），发送时间。“后端”传输和存储的消息结构在src/controller/init.js 263行，除以上内容外，还包含：发送者数字签名，哈希值，前一条消息的哈希值。但情况很复杂：有些字段要加密，有些不能加密，有些必须单独拿出来（如图片blob，要保持二进制格式来传输），详见src/controller/group.js中有关fetchFile和message的代码。

2. 重新设计数据库（Yunchen）

见src/controller/init.js 263行
